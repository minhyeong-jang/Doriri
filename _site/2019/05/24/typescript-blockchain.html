<!DOCTYPE html>
<html lang="kr">
<head>
  <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no"/>




<title>Typescript로 Blockchain 만들기</title>
<meta name="title" content="Typescript로 Blockchain 만들기" />
<meta name="author" content="minhyeong.jang"/>
<meta name="description" content="Typescript?

"/>

<meta property="fb:app_id" content="481301675773678"/>

<meta property="og:site_name" content="Doriri Blog"/>
<meta property="og:type" content="article"/>
<meta property="og:title" content="Typescript로 Blockchain 만들기"/>
<meta property="og:description" content="Typescript?

"/>
<meta property="og:url" content="http://localhost:4000/2019/05/24/typescript-blockchain"/>
<meta property="og:image" content="http://localhost:4000/assets/images/covers/nomadcoders.png"/>
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="627" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="Typescript로 Blockchain 만들기"/>
<meta name="twitter:description" content="Typescript?

"/>
<meta name="twitter:label1" content="Written by"/>
<meta name="twitter:data1" content="minhyeong.jang"/>
<meta name="twitter:image:src" content="http://localhost:4000/assets/images/covers/nomadcoders.png"/>

<meta name="twitter:label2" content="Filed under"/>
<meta name="twitter:data2" content="dev-blog,nomadcoders"/>

<meta property="article:tag" content="dev-blog"/>

<meta property="article:tag" content="nomadcoders"/>



<meta property="article:published_time" content="2019-05-24T23:33:00+09:00"/>


<meta property="article:author" content="http://localhost:4000/authors/minhyeong.jang"/>


<link rel="icon" type="image/x-icon" href="http://localhost:4000/assets/images/design/favicon.ico">

<link rel="stylesheet" href="http://localhost:4000/assets/css/index.css">
<link rel="stylesheet" href="http://localhost:4000/assets/css/prism.css">
<!-- <link
  href="https://fonts.googleapis.com/css?family=Noto+Sans+KR:300,400,500,700&display=swap&subset=korean"
  rel="stylesheet"
/> -->
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
<script src="/assets/js/main.js"></script>
<script src="/assets/js/prism.js"></script>
</head>

<body>
  <div id="header">
  <div class="top">
    <a href="/">Doriri</a>
    <button type="button" class="menu-btn" onClick="toggleMenu()"></button>
  </div>

  <ul class="menu">
    <li class="">
      <a href="/about">About</a>
    </li>
    
    <li>
      <a href="/categories/dev-blog">Dev Blog</a>
    </li>
    
    <li>
      <a href="/categories/etc-blog">Etc Blog</a>
    </li>
    
    <li>
      <a href="/contact">Contact</a>
    </li>
  </ul>
</div>
  <div class="body-wrap">
    <div id="navbar">
  <div class="fixed">
    <div class="info-wrap">
      <a href="/">
        <p class="user-name">Minhyeong Jang</p>
        <p class="nick-name">Doriri</p>
      </a>
    </div>
    <ul class="menu-wrap">
      <li class="">
        <a href="/about">About</a>
      </li>
      
      <li class="
         active ">
        <a href="/categories/dev-blog">Dev Blog</a>
        <ul class="menu-sub">
          
            
              
              <li class="">
                <a href="/tags/algorithm">Algorithm</a>
              </li>
            
          
            
              
              <li class="">
                <a href="/tags/dev-etc">Etc</a>
              </li>
            
          
            
          
            
              
              <li class="">
                <a href="/tags/javascript">Javascript</a>
              </li>
            
          
            
              
              <li class=" active ">
                <a href="/tags/nomadcoders">Nomad Coders</a>
              </li>
            
          
            
              
              <li class="">
                <a href="/tags/react-native">React Native</a>
              </li>
            
          
            
              
              <li class="">
                <a href="/tags/react">React</a>
              </li>
            
          
            
              
              <li class="">
                <a href="/tags/style">Style ( CSS, Etc )</a>
              </li>
            
          
        </ul>
      </li>
      
      <li class="
        ">
        <a href="/categories/etc-blog">Etc Blog</a>
        <ul class="menu-sub">
          
            
          
            
          
            
              
              <li class="">
                <a href="/tags/essay">Essay</a>
              </li>
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </li>
      
      <li>
        <a href="/contact">Contact</a>
      </li>
    </ul>

    <div class="contact">        
      <a href="//www.facebook.com/profile.php?id=100004096860602" target="_blank">
        <span class="icon icon-facebook2"></span>
      </a>
      <a href="//www.linkedin.com/in/minhyeong-jang-109b89116/" target="_blank">
        <span class="icon icon-linkedin"></span>
      </a>
      <a href="//github.com/minhyeong-jang" target="_blank">
        <span class="icon icon-github"></span>
      </a>
      <a href="/contact/">
        <span class="icon icon-mail3"></span>
      </a>
    </div>
  </div>
</div>

    <div id="content-wrap">
      <div id="cover"
  
    style="background-image: url(/assets/images/covers/nomadcoders.png)"
  >
  <div class="mouse-scroll">
    <img src="/assets/images/design/icon-mouse-scroll.png" alt="mouse-scroll">
  </div>
</div>

<div id="post-content">
  <div class="reponsive-content">
    <div class="post-info">
      <h1 class="post-title">Typescript로 Blockchain 만들기</h1>
      <p class="post-date red">2019년 05월 24일</p>
    </div>
    <div><h2 id="typescript">Typescript?</h2>

<p>Typescript는 프로그래밍 언어로 Javascript + Type의 합성어이다. 컴파일 시 Javascript로 변환된다.<br />
Javascript가 유명한 건 엄격한 규칙이 없기 때문에 사용하기 쉽고, 우리가 원하는 방향으로 수정하기도 쉽다.
하지만 큰 프로젝트에서 일을 하거나 버그를 최소화하고 싶다면 위의 장점이 단점이 된다.
Typescript로 작성하면 기능 예측이 가능하며, 코드를 읽기 쉬워지게 된다.</p>

<h2 id="설치">설치</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yarn add typescript
yarn add tsc-watch <span class="nt">--dev</span>
yarn add crypto-js
</code></pre></div></div>

<p>참고 : <code class="language-plaintext highlighter-rouge">yarn global add typescript</code> 로 설치하는 경우, tsc-watch가 인식하지 못하는 오류가 있습니다.</p>

<h2 id="설정">설정</h2>

<p><strong>tsconfig.json</strong><br />
Typescript =&gt; Javascript 변환할 떄 반영하는 설정</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ES2015"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sourceMap"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"outDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dist"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">"module": "commonjs"</code> node.js 평범하게 import, export 한다.<br />
<code class="language-plaintext highlighter-rouge">"target": "ES2015"</code> ES5 버전으로 컴파일 한다.<br />
<code class="language-plaintext highlighter-rouge">"sourceMap": true</code> Sourcemap을 설정한다. ( Sourcemap 이란? )<br />
<code class="language-plaintext highlighter-rouge">"outDir": "dist"</code> dist 파일로 컴파일된 파일을 출력한다.
<code class="language-plaintext highlighter-rouge">"include": ["src/**/*"]</code> 컴파일 과정에서 포함할 파일 ( src 폴더 내 전체 파일 )
<code class="language-plaintext highlighter-rouge">"excude": ["node_modules"]</code> 컴파일 과정에서 미포함 파일</p>
</blockquote>

<p><strong>tsc-watch</strong><br />
소스코드 수정 시 자동으로 컴파일을 진행한다.</p>

<p>기존 스크립트 : yarn start 시 컴파일 및 index.js를 실행한다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node index.js"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"prestart"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tsc"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>tsc watch 스크립트 : tsc-watch가 소스코드 변경사항을 확인하여 컴파일, 실행한다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tsc-watch --onSuccess </span><span class="se">\"</span><span class="s2"> node dist/index.js</span><span class="se">\"</span><span class="s2"> "</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="타입-체크">타입 체크</h2>

<p><strong>단순 함수</strong><br />
name, gender은 문자열, age는 숫자이다. 함수의 return 타입은 string 이다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">sayHi</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">age</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">gender</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">`Hello </span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">, you are </span><span class="p">${</span><span class="nx">age</span><span class="p">}</span><span class="s2">, you are a </span><span class="p">${</span><span class="nx">gender</span><span class="p">}</span><span class="s2">!`</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">sayHi</span><span class="p">(</span><span class="dl">"</span><span class="s2">Minhyeong</span><span class="dl">"</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="dl">"</span><span class="s2">male</span><span class="dl">"</span><span class="p">);</span>

<span class="k">export</span> <span class="p">{};</span>
</code></pre></div></div>

<p><strong>Interface</strong><br />
오브젝트에 대한 타입을 선언 후 함수에서 인자 값 타입을 Interface Human으로 정의한다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">Human</span> <span class="p">{</span>
  <span class="nl">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="nl">age</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="nl">gender</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">sayHi</span> <span class="o">=</span> <span class="p">(</span><span class="nx">person</span><span class="p">:</span> <span class="nx">Human</span><span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">`Hello </span><span class="p">${</span><span class="nx">person</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">, you are </span><span class="p">${</span><span class="nx">person</span><span class="p">.</span><span class="nx">age</span><span class="p">}</span><span class="s2">, you are a </span><span class="p">${</span><span class="nx">person</span><span class="p">.</span><span class="nx">gender</span><span class="p">}</span><span class="s2">!`</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Minhyeong</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
  <span class="na">gender</span><span class="p">:</span> <span class="dl">"</span><span class="s2">male</span><span class="dl">"</span>
<span class="p">};</span>
<span class="nx">sayHi</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span>

<span class="k">export</span> <span class="p">{};</span>
</code></pre></div></div>

<p><strong>Class</strong><br />
Human 클래스를 선언하여 타입을 체크하고 객체를 생성한다.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Human</span> <span class="p">{</span>
  <span class="kr">public</span> <span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">age</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">gender</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">age</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">gender</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">gender</span> <span class="o">=</span> <span class="nx">gender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">min</span><span class="p">:</span> <span class="nx">Human</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Human</span><span class="p">(</span><span class="dl">"</span><span class="s2">Minhyeong</span><span class="dl">"</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="dl">"</span><span class="s2">male</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">sayHi</span> <span class="o">=</span> <span class="p">(</span><span class="nx">person</span><span class="p">:</span> <span class="nx">Human</span><span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">`Hello </span><span class="p">${</span><span class="nx">person</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2">, you are </span><span class="p">${</span><span class="nx">person</span><span class="p">.</span><span class="nx">age</span><span class="p">}</span><span class="s2">, you are a </span><span class="p">${</span>
    <span class="nx">person</span><span class="p">.</span><span class="nx">gender</span>
  <span class="p">}</span><span class="s2">!`</span><span class="p">;</span>
<span class="p">};</span>
<span class="nx">sayHi</span><span class="p">(</span><span class="nx">min</span><span class="p">);</span>

<span class="k">export</span> <span class="p">{};</span>
</code></pre></div></div>

<h2 id="소스코드">소스코드</h2>

<p><a href="https://github.com/minhyeong-jang/typechain/blob/master/src/index.ts">Github / index.ts</a></p>

<ul>
  <li>블록체인 형태로 개발을 진행한다.
    <ul>
      <li>배열의 맨 마지막 해쉬 값과 생성될 데이터의 값을 합쳐 새로운 해쉬값을 생성합니다.<br />
ex) SHA256( 마지막 해쉬 + ( index, 생성시간, 데이터 내용 ) )</li>
    </ul>
  </li>
  <li>Class 형태로 선언하여, Typescript를 활용하여 로직을 구현합니다.</li>
</ul>

<p><strong>흐름순서</strong></p>

<ol>
  <li>createNewBlock 함수에서 암호화에 필요한 데이터를 호출</li>
  <li>Block.calculateBlockHash 에서 해쉬 값을 생성</li>
  <li>addBlock 함수에서 isBlockValid 함수를 호출하여 이전 블록과 추가되는 블록의 Validation을 체크 및 push</li>
</ol>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">CryptoJS</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">crypto-js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">Block</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">calculateBlockHash</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nx">index</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">previousHash</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">timestamp</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">data</span><span class="p">:</span> <span class="nx">string</span>
  <span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span>
    <span class="nx">CryptoJS</span><span class="p">.</span><span class="nx">SHA256</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="nx">previousHash</span> <span class="o">+</span> <span class="nx">timestamp</span> <span class="o">+</span> <span class="nx">data</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>

  <span class="kd">static</span> <span class="nx">validateStructure</span> <span class="o">=</span> <span class="p">(</span><span class="nx">aBlock</span><span class="p">:</span> <span class="nx">Block</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span>
    <span class="k">typeof</span> <span class="nx">aBlock</span><span class="p">.</span><span class="nx">index</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
    <span class="k">typeof</span> <span class="nx">aBlock</span><span class="p">.</span><span class="nx">hash</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
    <span class="k">typeof</span> <span class="nx">aBlock</span><span class="p">.</span><span class="nx">previousHash</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
    <span class="k">typeof</span> <span class="nx">aBlock</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span> <span class="o">&amp;&amp;</span>
    <span class="k">typeof</span> <span class="nx">aBlock</span><span class="p">.</span><span class="nx">data</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">;</span>

  <span class="kr">public</span> <span class="nx">index</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">hash</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">previousHash</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">data</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
  <span class="kr">public</span> <span class="nx">timestamp</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span>
    <span class="nx">index</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
    <span class="nx">hash</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">previousHash</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">data</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
    <span class="nx">timestamp</span><span class="p">:</span> <span class="nx">number</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">previousHash</span> <span class="o">=</span> <span class="nx">previousHash</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">genesisBlock</span><span class="p">:</span> <span class="nx">Block</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">aaaabbbbbbccccc</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">firstBlock</span><span class="dl">"</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">blockchain</span><span class="p">:</span> <span class="nx">Block</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">genesisBlock</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">getBlockchain</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">Block</span><span class="p">[]</span> <span class="o">=&gt;</span> <span class="nx">blockchain</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getLatestBlock</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">Block</span> <span class="o">=&gt;</span> <span class="nx">blockchain</span><span class="p">[</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">getNewTimeStamp</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">number</span> <span class="o">=&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">createNewBlock</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">Block</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">previousBlock</span><span class="p">:</span> <span class="nx">Block</span> <span class="o">=</span> <span class="nx">getLatestBlock</span><span class="p">();</span>
  <span class="kd">const</span> <span class="na">newIndex</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="nx">previousBlock</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">const</span> <span class="na">newTimestamp</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="nx">getNewTimeStamp</span><span class="p">();</span>
  <span class="kd">const</span> <span class="na">newHash</span><span class="p">:</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">Block</span><span class="p">.</span><span class="nx">calculateBlockHash</span><span class="p">(</span>
    <span class="nx">newIndex</span><span class="p">,</span>
    <span class="nx">previousBlock</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span>
    <span class="nx">newTimestamp</span><span class="p">,</span>
    <span class="nx">data</span>
  <span class="p">);</span>
  <span class="kd">const</span> <span class="na">newBlock</span><span class="p">:</span> <span class="nx">Block</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span>
    <span class="nx">newIndex</span><span class="p">,</span>
    <span class="nx">newHash</span><span class="p">,</span>
    <span class="nx">previousBlock</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span>
    <span class="nx">data</span><span class="p">,</span>
    <span class="nx">newTimestamp</span>
  <span class="p">);</span>
  <span class="nx">addBlock</span><span class="p">(</span><span class="nx">newBlock</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">newBlock</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">getHashforBlock</span> <span class="o">=</span> <span class="p">(</span><span class="nx">aBlock</span><span class="p">:</span> <span class="nx">Block</span><span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span>
  <span class="nx">Block</span><span class="p">.</span><span class="nx">calculateBlockHash</span><span class="p">(</span>
    <span class="nx">aBlock</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span>
    <span class="nx">aBlock</span><span class="p">.</span><span class="nx">previousHash</span><span class="p">,</span>
    <span class="nx">aBlock</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">,</span>
    <span class="nx">aBlock</span><span class="p">.</span><span class="nx">data</span>
  <span class="p">);</span>

<span class="kd">const</span> <span class="nx">isBlockValid</span> <span class="o">=</span> <span class="p">(</span><span class="nx">candidateBlock</span><span class="p">:</span> <span class="nx">Block</span><span class="p">,</span> <span class="nx">previousBlock</span><span class="p">:</span> <span class="nx">Block</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Block</span><span class="p">.</span><span class="nx">validateStructure</span><span class="p">(</span><span class="nx">candidateBlock</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">previousBlock</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!==</span> <span class="nx">candidateBlock</span><span class="p">.</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">previousBlock</span><span class="p">.</span><span class="nx">hash</span> <span class="o">!==</span> <span class="nx">candidateBlock</span><span class="p">.</span><span class="nx">previousHash</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">getHashforBlock</span><span class="p">(</span><span class="nx">candidateBlock</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">candidateBlock</span><span class="p">.</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">addBlock</span> <span class="o">=</span> <span class="p">(</span><span class="nx">candidateBlock</span><span class="p">:</span> <span class="nx">Block</span><span class="p">):</span> <span class="k">void</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isBlockValid</span><span class="p">(</span><span class="nx">candidateBlock</span><span class="p">,</span> <span class="nx">getLatestBlock</span><span class="p">()))</span> <span class="p">{</span>
    <span class="nx">blockchain</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">candidateBlock</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">createNewBlock</span><span class="p">(</span><span class="dl">"</span><span class="s2">second block</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">createNewBlock</span><span class="p">(</span><span class="dl">"</span><span class="s2">third block</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">createNewBlock</span><span class="p">(</span><span class="dl">"</span><span class="s2">fourth block</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">getBlockchain</span><span class="p">());</span>

<span class="k">export</span> <span class="p">{};</span>
</code></pre></div></div>

<h2 id="후기">후기</h2>

<p>Typescript를 기초도 모르는 상태로 개발할 때 “아 이러한 상황에선 이렇게 하면 되는구나”라는 식으로 진행했었다. 강의를 들어보니 내가 놓치고 지나간 부분들이 많다는 것을 알고 새롭게 배웠다. ( 블록체인의 구조도 배운 건 일석이조였다. )</p>

<h2 id="reference">Reference</h2>

<p>Github : <a href="https://github.com/minhyeong-jang/typechain/">typechain</a><br />
Reference : <a href="https://academy.nomadcoders.co/p/build-a-blockchain-with-typescript?ref=map">nomadcoders</a></p>
</div>
  </div>

  <!-- 

<span style="color: silver;">Share on: </span>
<div id="share-buttons">
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=http://localhost:4000/2019/05/24/typescript-blockchain');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=http://localhost:4000/2019/05/24/typescript-blockchain');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2019/05/24/typescript-blockchain&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
    <div class="pinterest" title="Share this on Pinterest" onclick="window.open('https://pinterest.com/pin/create/button/?url=&media=http://localhost:4000/covers/nomadcoders.png&description=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M256 597q0-108 37.5-203.5t103.5-166.5 152-123 185-78 202-26q158 0 294 66.5t221 193.5 85 287q0 96-19 188t-60 177-100 149.5-145 103-189 38.5q-68 0-135-32t-96-88q-10 39-28 112.5t-23.5 95-20.5 71-26 71-32 62.5-46 77.5-62 86.5l-14 5-9-10q-15-157-15-188 0-92 21.5-206.5t66.5-287.5 52-203q-32-65-32-169 0-83 52-156t132-73q61 0 95 40.5t34 102.5q0 66-44 191t-44 187q0 63 45 104.5t109 41.5q55 0 102-25t78.5-68 56-95 38-110.5 20-111 6.5-99.5q0-173-109.5-269.5t-285.5-96.5q-200 0-334 129.5t-134 328.5q0 44 12.5 85t27 65 27 45.5 12.5 30.5q0 28-15 73t-37 45q-2 0-17-3-51-15-90.5-56t-61-94.5-32.5-108-11-106.5z"/></svg></div>
    <div class="gplus" title="Share this on Google Plus" onclick="window.open('https://plus.google.com/share?url=http://localhost:4000/2019/05/24/typescript-blockchain');"><svg viewBox="0 0 2304 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1437 913q0 208-87 370.5t-248 254-369 91.5q-149 0-285-58t-234-156-156-234-58-285 58-285 156-234 234-156 285-58q286 0 491 192l-199 191q-117-113-292-113-123 0-227.5 62t-165.5 168.5-61 232.5 61 232.5 165.5 168.5 227.5 62q83 0 152.5-23t114.5-57.5 78.5-78.5 49-83 21.5-74h-416v-252h692q12 63 12 122zm867-122v210h-209v209h-210v-209h-209v-210h209v-209h210v209h209z"/></svg></div>
    <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=http://localhost:4000/2019/05/24/typescript-blockchain');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div> -->

  <div id="post-links">
    <div class="subject">이런 글은 어떠신가요?</div>
    <ul>
      <!-- 다음 포스트가 없는 경우 -->
      

        
        <li>
  <a href="/2019/05/29/programmers-number-games">
    <div class="post-image"
      
        style="background-image:url(/assets/images/covers/programmers.jpg)"
      
      ></div>
    <div class="post-info">
      <p class="author-name">minhyeong.jang</p>
      <h3 class="post-title">programmers - 숫자게임</h3>
      <p class="post-date">2019년 05월 29일</p>
      <p class="post-excerpt">## 문제 xx 회사의 2xN명의 사원들은 N명씩 두 팀으로 나눠 숫자 게임을 하려고 합니다. 두 개의 팀을 각각 A팀과 B팀이라고 하겠습니다. 숫자 게임의 규칙은 다음과 같습니다. 먼저 모든 사원이 무작위로 자연수를 하나씩 부여받습니다. 각 사원은 딱 한 번씩 경기를 합니다. 각 경기당 A팀에서 한 사원이, B팀에서 한 사원이 나와 서로의 수를 공개합니다. 그때 숫자가 큰 쪽이 승리하게 되고, 승리한 사원이 속한 팀은 승점을 1점 얻게 됩니다. 만약 숫자가 같다면 누구도 승점을 얻지 않습니다. 전체 사원들은 우선 무작위로 자연수를 하나씩 부여받았습니다. 그다음 A팀은 빠르게 출전순서를 정했고 자신들의 출전 순서를 B팀에게 공개해버렸습니다. B팀은 그것을 보고 자신들의 최종 승점을 가장 높이는 방법으로 팀원들의 출전 순서를 정했습니다. 이때의 B팀이 얻는 승점을 구해주세요. A 팀원들이 부여받은 수가 출전 순서대로 나열되어있는 배열 A와 i번째 원소가 B팀의 i번 팀원이 부여받은 수를 의미하는 배열 B가 주어질 때, B 팀원들이 얻을 수 있는 최대 승점을 return 하도록 solution 함수를 완성해주세요. 제한사항 > A와 B의 길이는 같습니다. > A와 B의...</p>
    </div>
  </a>
</li>
        
        
        <li>
  <a href="/2019/05/27/git-errors">
    <div class="post-image"
      
        style="background-image:url(/assets/images/covers/github.png)"
      
      ></div>
    <div class="post-info">
      <p class="author-name">minhyeong.jang</p>
      <h3 class="post-title">git refusing to merge unrelated histories</h3>
      <p class="post-date">2019년 05월 27일</p>
      <p class="post-excerpt">## fatal: refusing to merge unrelated histories

로컬 저장소에서 Git Repo 생성 후 push 하는 경우, 프로젝트 충돌로 나타나는 오류이다.

```bash
git pull origin main --allow-unrelated-histories
```
</p>
    </div>
  </a>
</li>
  
        
        <li>
  <a href="/2019/05/24/sourcemap">
    <div class="post-image"
      
        style="background-image:url(/assets/images/covers/algorithm.jpg)"
      
      ></div>
    <div class="post-info">
      <p class="author-name">minhyeong.jang</p>
      <h3 class="post-title">Sourcemap 이란?</h3>
      <p class="post-date">2019년 05월 24일</p>
      <p class="post-excerpt">1. Sourcemap 이란?

많은 개발 환경은 Webpack 등으로 빌드 과정을 거치고있다. 만일 빌드 후 취합되거나 변환 된 CSS, JavaScript 파일들이 오류가 발생한다면, 개발자 도구에서는 빌드 된 파일에서 오류를 출력하고 있을 것이다. 하지만 우리가 원하는 것은 빌드 전 오류난 파일 및 라인을 알고싶은 것이다.

예를 들면, SCSS에 오류가 있고 Webpack으로 빌드를 진행하면 웹페이지에서 오류를 알려주는 부분은 빌드가 완료된 CSS를 출력한다. JavaScript도 마찬가지로 오류가 나면 취합하고 minify된 JS를 출력하고있다.

이럴때 Soucemap을 설정하면, 코드상의 위치를 기억하고 알려주기 때문에 빌드 전 어떤 파일, 라인에서 오류가 났는지 확인할 수 있다.

2. 설정

2.1 Webpack

Dev 환경에서만 작동하도록 설정하였다.

{
  "devtool": env.mode === "development" ? "source-map" : ""
}


2.2 Typescript

{
  "compilerOptions": {
    "sourceMap": true
  }
}

</p>
    </div>
  </a>
</li>
      
    </ul>
  </div>
</div>

<div id="disqus_thread"></div>
    </div>
  </div>
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154757538-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154757538-1');
</script>
<script data-ad-client="ca-pub-6988376755693780" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
  // var disqus_config = function() {
  //   this.page.url = "http://localhost:4000/2019/05/24/typescript-blockchain";
  //   this.page.identifier = "/2019/05/24/typescript-blockchain";
  // };

  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://minhyeong.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<script id="dsq-count-scr" src="//minhyeong.disqus.com/count.js" async></script>
<noscript>Please enable JavaScript to view the<a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</body>
</html>
